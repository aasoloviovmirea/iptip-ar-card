<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>IPTIP AR Card3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

 <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script>
  // –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π CDN –Ω–µ –¥–∞–ª A-Frame
  if (!window.AFRAME) {
    const s = document.createElement('script');
    s.src = "https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js";
    document.head.appendChild(s);
  }
</script>

<script>
  // –ó–∞–≥—Ä—É–∂–∞–µ–º MindAR —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ AFRAME —É–∂–µ –µ—Å—Ç—å
  function loadMindAR() {
    const s = document.createElement('script');
    s.src = "https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js";
    document.head.appendChild(s);
  }

  (function waitAFRAME(){
    if (window.AFRAME) { loadMindAR(); return; }
    setTimeout(waitAFRAME, 50);
  })();
</script>

</head>

<body>
  <div id="hint">–ù–∞–∂–º–∏ <b>¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª</b> ‚Üí —Ä–∞–∑—Ä–µ—à–∏ –∫–∞–º–µ—Ä—É ‚Üí –Ω–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É.</div>

  <button id="startBtn" class="btn">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
  <a id="vcfBtn" href="pushkin.vcf" class="btn">üìá –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</a>

  <a-scene
    id="scene"
    mindar-image="imageTargetSrc: ./marker.mind; uiScanning: yes; uiLoading: yes;"
    color-space="sRGB"
    renderer="colorManagement: true; physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    embedded>

    <a-assets>
      <!-- OBJ –ø–æ–¥–∫–ª—é—á–∞–µ–º —á–µ—Ä–µ–∑ obj-model -->
      <a-asset-item id="logoObj" src="./logo.obj"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      <!-- 3D –ª–æ–≥–æ—Ç–∏–ø -->
      <a-entity
        obj-model="obj: #logoObj"
        position="0 0 0"
        rotation="0 0 0"
        scale="0.35 0.35 0.35"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 6000">
      </a-entity>

      <!-- ‚Äú–ª–∞–∑–µ—Ä–Ω—ã–π –ª—É—á‚Äù -->
      <a-cylinder
        position="0 0.15 -0.45"
        radius="0.01"
        height="1.0"
        rotation="90 0 0"
        material="color: #00ffff; opacity: 0.9; transparent: true"
        animation="property: material.opacity; from: 0; to: 0.9; dur: 800; dir: alternate; loop: true">
      </a-cylinder>
    </a-entity>
  </a-scene>

  <script>
    const startBtn = document.getElementById('startBtn');
    const hint = document.getElementById('hint');
    const sceneEl = document.getElementById('scene');

    // MindAR –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø–æ –∫–ª–∏–∫—É (user gesture)
    startBtn.addEventListener('click', async () => {
  try {
    hint.innerHTML = "–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –∫–∞–º–µ—Ä—É‚Ä¶";

    await new Promise(resolve => {
      if (sceneEl.hasLoaded) return resolve();
      sceneEl.addEventListener("loaded", resolve, { once: true });
    });

    const mindarSystem = sceneEl.systems["mindar-image-system"];
    await mindarSystem.start();

    startBtn.style.display = 'none';
    hint.innerHTML = "‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞. –ù–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É.";
    setTimeout(()=>{ hint.style.display='none'; }, 3500);
  } catch (e) {
    console.error(e);
    hint.innerHTML = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å AR. –ü—Ä–∏—à–ª–∏ –æ—à–∏–±–∫—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏.";
  }
});


    // –ß—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener("visibilitychange", () => {
      const mindarSystem = sceneEl.systems["mindar-image-system"];
      if (!mindarSystem) return;
      if (document.hidden) {
        mindarSystem.stop();
      }
    });
  </script>
</body>
</html>


