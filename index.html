<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>IPTIP AR Card2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script>
  // –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π CDN –Ω–µ –¥–∞–ª A-Frame
  if (!window.AFRAME) {
    const s = document.createElement('script');
    s.src = "https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js";
    document.head.appendChild(s);
  }
</script>

<script>
  // –ó–∞–≥—Ä—É–∂–∞–µ–º MindAR —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ AFRAME —É–∂–µ –µ—Å—Ç—å
  function loadMindAR() {
    const s = document.createElement('script');
    s.src = "https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js";
    document.head.appendChild(s);
  }

  (function waitAFRAME(){
    if (window.AFRAME) { loadMindAR(); return; }
    setTimeout(waitAFRAME, 50);
  })();
</script>

</head>

<body>
  <div id="hint">–ù–∞–∂–º–∏ <b>¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª</b> ‚Üí —Ä–∞–∑—Ä–µ—à–∏ –∫–∞–º–µ—Ä—É ‚Üí –Ω–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É.</div>

  <button id="startBtn" class="btn">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
  <a id="vcfBtn" href="pushkin.vcf" class="btn">üìá –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</a>

  <a-scene
    id="scene"
    mindar-image="imageTargetSrc: ./marker.mind; uiScanning: yes; uiLoading: yes;"
    color-space="sRGB"
    renderer="colorManagement: true; physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    embedded>

    <a-assets>
      <!-- OBJ –ø–æ–¥–∫–ª—é—á–∞–µ–º —á–µ—Ä–µ–∑ obj-model -->
      <a-asset-item id="logoObj" src="./logo.obj"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">

  <!-- –ù–µ–±–æ–ª—å—à–∞—è ‚Äú–ø–æ–¥–ª–æ–∂–∫–∞‚Äù, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Å—Ü–µ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å -->
  <a-plane position="0 0 -0.01" width="1.1" height="0.7"
           material="color:#000; opacity:0.25; transparent:true"></a-plane>

  <!-- 3D-–ª–æ–≥–æ—Ç–∏–ø -->
  <a-entity id="logo"
    obj-model="obj: #logoObj"
    position="0 0.05 0"
    rotation="0 0 0"
    scale="0.01 0.01 0.01"
    animation__pop="property: scale; from: 0.01 0.01 0.01; to: 0.35 0.35 0.35; dur: 700; easing: easeOutBack"
    animation__spin="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
  </a-entity>

  <!-- ‚Äú–ü—Ä–∏–∑–º–∞‚Äù (–ø—Ä–æ—Å—Ç–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è) -->
  <a-entity id="prism" position="0.22 0.02 0" rotation="0 25 0">
    <a-box width="0.12" height="0.12" depth="0.12"
           material="color:#ffffff; opacity:0.25; transparent:true"></a-box>
    <a-box width="0.125" height="0.125" depth="0.125"
           material="color:#00c8ff; opacity:0.18; transparent:true"></a-box>
  </a-entity>

  <!-- –õ–∞–∑–µ—Ä–Ω—ã–π –ª—É—á (–∫ –ø—Ä–∏–∑–º–µ) -->
  <a-cylinder id="laserIn"
    position="-0.25 0.05 0"
    radius="0.008"
    height="0.55"
    rotation="0 0 90"
    material="color:#00ffff; opacity:0; transparent:true; emissive:#00ffff; emissiveIntensity:1">
    <a-animation attribute="material.opacity" from="0" to="0.9" dur="400" begin="0"></a-animation>
    <a-animation attribute="material.opacity" from="0.9" to="0.2" dur="900" begin="400" direction="alternate" loop="true"></a-animation>
  </a-cylinder>

  <!-- –õ—É—á –ø–æ—Å–ª–µ –ø—Ä–∏–∑–º—ã (—Ä–∞—Å–ø–∞–¥–∞–µ—Ç—Å—è –Ω–∞ —Ü–≤–µ—Ç–∞ ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è) -->
  <a-entity id="laserOut" position="0.05 0.05 0">
    <a-cylinder position="0.18 0.00 0.00" radius="0.006" height="0.38" rotation="0 0 90"
      material="color:#ff3b30; opacity:0; transparent:true; emissive:#ff3b30; emissiveIntensity:1">
      <a-animation attribute="material.opacity" from="0" to="0.8" dur="450" begin="250"></a-animation>
    </a-cylinder>
    <a-cylinder position="0.18 0.02 0.00" radius="0.006" height="0.38" rotation="0 0 90"
      material="color:#34c759; opacity:0; transparent:true; emissive:#34c759; emissiveIntensity:1">
      <a-animation attribute="material.opacity" from="0" to="0.8" dur="450" begin="350"></a-animation>
    </a-cylinder>
    <a-cylinder position="0.18 -0.02 0.00" radius="0.006" height="0.38" rotation="0 0 90"
      material="color:#007aff; opacity:0; transparent:true; emissive:#007aff; emissiveIntensity:1">
      <a-animation attribute="material.opacity" from="0" to="0.8" dur="450" begin="450"></a-animation>
    </a-cylinder>
  </a-entity>

  <!-- –í—Å–ø—ã—à–∫–∞/—á–∞—Å—Ç–∏—Ü—ã –≤–æ–∫—Ä—É–≥ –ª–æ–≥–æ—Ç–∏–ø–∞ -->
  <a-ring position="0 0.05 0.01" radius-inner="0.08" radius-outer="0.13"
          material="color:#00c8ff; opacity:0; transparent:true"
          animation__flash="property: material.opacity; from: 0; to: 0.9; dur: 180; delay: 650; dir: alternate; loop: true"></a-ring>

  <!-- –ü–æ–¥–ø–∏—Å—å (HUD) -->
  <a-text value="–ò–ü–¢–ò–ü ‚Ä¢ –†–¢–£ –ú–ò–†–≠–ê"
          position="-0.48 -0.22 0.02"
          color="#ffffff"
          width="1.6"
          opacity="0.9"></a-text>

</a-entity>


  <script>
    const startBtn = document.getElementById('startBtn');
    const hint = document.getElementById('hint');
    const sceneEl = document.getElementById('scene');

    // MindAR –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø–æ –∫–ª–∏–∫—É (user gesture)
    startBtn.addEventListener('click', async () => {
  try {
    hint.innerHTML = "–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –∫–∞–º–µ—Ä—É‚Ä¶";

    await new Promise(resolve => {
      if (sceneEl.hasLoaded) return resolve();
      sceneEl.addEventListener("loaded", resolve, { once: true });
    });

    const mindarSystem = sceneEl.systems["mindar-image-system"];
    await mindarSystem.start();

    startBtn.style.display = 'none';
    hint.innerHTML = "‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞. –ù–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É.";
    setTimeout(()=>{ hint.style.display='none'; }, 3500);
  } catch (e) {
    console.error(e);
    hint.innerHTML = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å AR. –ü—Ä–∏—à–ª–∏ –æ—à–∏–±–∫—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏.";
  }
});


    // –ß—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener("visibilitychange", () => {
      const mindarSystem = sceneEl.systems["mindar-image-system"];
      if (!mindarSystem) return;
      if (document.hidden) {
        mindarSystem.stop();
      }
    });
  </script>
</body>
</html>




