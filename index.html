<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>IPTIP AR Card1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; }
    .btn {
      position: fixed; left: 50%; transform: translateX(-50%);
      padding: 14px 18px; border-radius: 12px; font-size: 16px;
      text-decoration: none; z-index: 9999; border: 0; cursor: pointer;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    #startBtn { bottom: 76px; background:#00c8ff; color:#001018; font-weight:700; }
    #vcfBtn   { bottom: 20px; background:#111; color:#fff; }
    #hint {
      position: fixed; top: 14px; left: 50%; transform: translateX(-50%);
      padding: 10px 14px; border-radius: 12px; color:#fff;
      background: rgba(0,0,0,.55); z-index: 9999; font-size: 14px;
      text-align:center; max-width: 92vw;
    }
  </style>
</head>

<body>
  <div id="hint">–ù–∞–∂–º–∏ <b>¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª</b> ‚Üí —Ä–∞–∑—Ä–µ—à–∏ –∫–∞–º–µ—Ä—É ‚Üí –Ω–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É.</div>

  <button id="startBtn" class="btn">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
  <a id="vcfBtn" href="pushkin.vcf" class="btn">üìá –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</a>

  <a-scene
    id="scene"
    mindar-image="imageTargetSrc: ./marker.mind; uiScanning: yes; uiLoading: yes;"
    color-space="sRGB"
    renderer="colorManagement: true; physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    embedded>

    <a-assets>
      <!-- OBJ –ø–æ–¥–∫–ª—é—á–∞–µ–º —á–µ—Ä–µ–∑ obj-model -->
      <a-asset-item id="logoObj" src="./logo.obj"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      <!-- 3D –ª–æ–≥–æ—Ç–∏–ø -->
      <a-entity
        obj-model="obj: #logoObj"
        position="0 0 0"
        rotation="0 0 0"
        scale="0.35 0.35 0.35"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 6000">
      </a-entity>

      <!-- ‚Äú–ª–∞–∑–µ—Ä–Ω—ã–π –ª—É—á‚Äù -->
      <a-cylinder
        position="0 0.15 -0.45"
        radius="0.01"
        height="1.0"
        rotation="90 0 0"
        material="color: #00ffff; opacity: 0.9; transparent: true"
        animation="property: material.opacity; from: 0; to: 0.9; dur: 800; dir: alternate; loop: true">
      </a-cylinder>
    </a-entity>
  </a-scene>

  <script>
    const startBtn = document.getElementById('startBtn');
    const hint = document.getElementById('hint');
    const sceneEl = document.getElementById('scene');

    // MindAR –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø–æ –∫–ª–∏–∫—É (user gesture)
    startBtn.addEventListener('click', async () => {
      try {
        hint.innerHTML = "–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –∫–∞–º–µ—Ä—É‚Ä¶ –µ—Å–ª–∏ –Ω–µ —Å–ø—Ä–æ—Å–∏—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–∞–π—Ç–∞.";
        const mindarSystem = sceneEl.systems["mindar-image-system"];
        await mindarSystem.start();

        startBtn.style.display = 'none';
        hint.innerHTML = "‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞. –ù–∞–≤–µ–¥–∏ –Ω–∞ –≤–∏–∑–∏—Ç–∫—É (marker.jpg).";
        setTimeout(()=>{ hint.style.display='none'; }, 3500);
      } catch (e) {
        console.error(e);
        hint.innerHTML = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å AR. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –ø—Ä–∏—à–ª–∏ –æ—à–∏–±–∫—É.";
      }
    });

    // –ß—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener("visibilitychange", () => {
      const mindarSystem = sceneEl.systems["mindar-image-system"];
      if (!mindarSystem) return;
      if (document.hidden) {
        mindarSystem.stop();
      }
    });
  </script>
</body>
</html>
